ec.pkg("ec.product");ec.load("ajax");ec.load("ec.box",{loadType:"lazy"});ec.load("ec.form",{loadType:"lazy"});ec.product.cid="";ec.product.sortField="";ec.product.sortType="";ec.product.prdAttrList=[];ec.product.email=ec.util.escapeHtml(ec.account.email);ec.product.mobile=ec.util.escapeHtml(ec.account.mobile);ec.product.chooseCategory=function(a){ec.product.cid=a;ec.product.post()};ec.product.chooseAttrAllValue=function(a){ec.product.prdAttrList=ec.product.removeAtrribute(ec.product.prdAttrList,"attributeId",a);ec.product.tmpOptAttrValue(a);ec.product.post()};ec.product.chooseAttrValue=function(b,c){ec.product.prdAttrList=ec.product.removeAtrribute(ec.product.prdAttrList,"attributeId",b);ec.product.tmpOptAttrValue(b);var a={};a.attributeId=b;a.value=c;ec.product.prdAttrList.push(a);ec.product.post()};ec.product.tmpOptAttrValue=function(a){if(a=="102435"||a=="102434"||a=="102436"){ec.product.prdAttrList=ec.product.removeAtrribute(ec.product.prdAttrList,"attributeId","102434");ec.product.prdAttrList=ec.product.removeAtrribute(ec.product.prdAttrList,"attributeId","102435");ec.product.prdAttrList=ec.product.removeAtrribute(ec.product.prdAttrList,"attributeId","102436")}};ec.product.sort=function(a){cur_sortField=ec.product.sortField||"registterTime",cur_sortType=ec.product.sortType||"desc",new_sortType="";switch(a){case"default":new_sortType="";break;case"remarkNumber":new_sortType="desc";break;default:if(a==cur_sortField){new_sortType=cur_sortType=="desc"?"asc":"desc"}else{if(a=="price"){new_sortType="asc"}else{new_sortType="desc"}}break}ec.product.sortType=new_sortType;ec.product.sortField=a;ec.product.post()};ec.product.more=function(c){var b=$(c).attr("class");if(b=="more more-expand"){$(c).attr("class","more more-drop");var a=$(c).parent(".p-operate").next(".p-expand").find("ul").first().outerHeight();$(c).parent(".p-operate").next(".p-expand").height(a)}else{$(c).attr("class","more more-expand");$(c).parent(".p-operate").next(".p-expand").removeAttr("style")}};ec.product.renderPage=function(e,d,a,c,b){ec.product.cid=e;ec.product.sortField=a;ec.product.sortType=c;ec.product.renderCategory();ec.product.renderAttribute(d);ec.product.renderSort(a,c);if(!b.totalPage||b.totalPage==1){return}$("#list-pager-"+e).pager({pageNumber:b.pageNumber,pageCount:b.totalPage,recordCount:b.totalRow,qpageSize:5,text:{first:"|&lt;",pre:"&lt",next:"&gt;",last:"&gt;|"},item:["first","pre","qpage","next","last","quickPager"],callBack:ec.product.post})};ec.product.renderCategory=function(){$(".p-expand ul").each(function(){var b=$(this).children("li").first().outerHeight();var a=$(this).outerHeight();if(a>b){$(this).parent(".p-expand").prev(".p-operate").show()}})};ec.product.renderAttribute=function(d){for(var a=0;a<d.length;a++){var c=d[a];var b=c.attributeId;if(b=="102435"||b=="102434"||b=="102436"){$("#pro-cate-attr-102435").find("#pro-cate-attr-all").removeClass("selected");$("#pro-cate-attr-102434").find("#pro-cate-attr-all").removeClass("selected");$("#pro-cate-attr-102436").find("#pro-cate-attr-all").removeClass("selected");$("#pro-cate-attr-102435 li a:contains("+c.value+")[innerHTML="+c.value+"]").parent("li").addClass("selected");$("#pro-cate-attr-102434 li a:contains("+c.value+")[innerHTML="+c.value+"]").parent("li").addClass("selected");$("#pro-cate-attr-102436 li a:contains("+c.value+")[innerHTML="+c.value+"]").parent("li").addClass("selected")}else{$("#pro-cate-attr-"+c.attributeId).find("#pro-cate-attr-all").removeClass("selected");$("#pro-cate-attr-"+c.attributeId+" li a:contains("+c.value+")[innerHTML="+c.value+"]").parent("li").addClass("selected")}}ec.product.prdAttrList=d};ec.product.renderSort=function(a,b){switch(a){case"default":break;case"remarkNumber":$("#sort-remarkNumber").addClass("sort-desc");break;default:$("#sort-"+a).addClass("sort-"+b);break}$("#sort-"+a).addClass("selected")};ec.product.post=function(b){var a=(b?b.pageNumber:1);var d=ec.product.cid;var c=ec.lang.json.stringify(ec.product.prdAttrList);$("#listForm").append("<input type='hidden' name='sortField' value='"+ec.product.sortField+"' />").append("<input type='hidden' name='sortType' value='"+ec.product.sortType+"' />").append("<input type='hidden' name='prdAttrList' value='"+c+"' />");$("#listForm").attr("action",domainMain+"/list-data-"+d+"-"+a);$("#listForm").submit()};ec.product.arrival=function(a){ec.account.afterLogin(function(){ec.product.syncCustomSession();var c=ec.product.email;var b=ec.product.mobile;var e="";var d=new ec.box($("#product-arrival-html").val(),{boxid:"product-arriva-box",boxclass:"ol_box_4",title:"Arrival Notice",showButton:false,onopen:function(f){if(ec.util.isEmpty(c)){$("#arrival-email").attr("class","disabled");$("#account-email").html('Unbound Secure Mailbox &nbsp;<a href="'+domainMain+'"/member/account"  onclick="ec.product.bind()">To Bind</a>')}else{$("#arrival-email").bind("click",function(){e=ec.product.chooseNoticeType("email")});$("#account-email").html(c)}if(ec.util.isEmpty(b)){$("#arrival-mobile").attr("class","disabled");$("#account-mobile").html('Unbound Secure Mailbox &nbsp;<a href="'+domainMain+'"/member/account"  onclick="ec.product.bind()">To Bind</a>')}else{$("#arrival-mobile").bind("click",function(){e=ec.product.chooseNoticeType("mobile")});$("#account-mobile").html(ec.product.splitMobile(b))}},onok:function(h){if(e.length==0){$("#arrival-error span").html("Please choose a notification mode!");$("#arrival-error").removeClass("hide");return}var g="1";var f=c;if(e=="mobile"){g="3";f=b}new ec.ajax().submit({url:domainMain+"/product/arrivalMail.json",data:{informWay:f,type:g,skuId:a},timeout:10000,timeoutFunction:function(){$("#arrival-error span").html("Operation timeout, please try again!");$("#arrival-error").removeClass("hide")},beforeSendFunction:ec.ui.loading.show,afterSendFunction:ec.ui.loading.hide,successFunction:function(i){if(!i.success){$("#arrival-error span").html(i.msg);$("#arrival-error").removeClass("hide");return}alert("Set up successfully!");$("#arrival-error").addClass("hide");h.close();$(".ol_box_mask").remove()}})},onclose:function(f){$(".ol_box_mask").remove()}});d.open();ec.product.bind=function(){d.close();$(".ol_box_mask").remove()}})};ec.product.chooseNoticeType=function(a){$("#arrival-email").removeClass("selected");$("#arrival-mobile").removeClass("selected");$("#arrival-"+a).attr("class","selected");return a};ec.product.splitMobile=function(b){var a="";for(var c=0;c<(b.length);c++){if((b.length-c)%4==0){a+="&nbsp;&nbsp;"}a+=b.substring(c,c+1)}return a};ec.product.syncCustomSession=function(){new ec.ajax().get({async:false,url:domainMain+"/account/syncEmailAndMobile.json",timeout:10000,successFunction:function(a){if(!ec.util.isEmpty(a.customerInfo)){ec.product.email=a.customerInfo.email;ec.product.mobile=a.customerInfo.mobile}return},timeoutFunction:function(){return},errorFunction:function(){return}})};ec.product.disableAddCartButtons=function(a){$("#add-cat-"+a).attr("class","p-button-cart-disabled")};ec.product.enableAddCartButtons=function(a){$("#add-cat-"+a).attr("class","p-button-cart")};ec.product.addCart=function(b,e){ec.product.disableAddCartButtons(b);var c;var a=[];a[0]=b;var f=[];f[0]="";var d=[];d[0]=1;var g=[];g[0]=1;c={skuIds:a,extendSkuIds:f,quantity:g,type:d};ec.cart.add(c,{successFunction:function(h){ec.cart.getCartBaseInfo(h.cart,function(i){var j=new ec.box($("#cart-tips").val(),{boxid:"product-cart-box",boxclass:"ol_box_4",showButton:false,onopen:function(p){$("#cart-briefName").html(e);var o=i.cartInfo;$("#cart-total, #header-cart-total").html(o.totalNumber);var l=0;var A=0;var s=0;for(var n=0;n<o.bundlerList.length;n++){var B=o.bundlerList[n];l+=B.originalPrice*B.quantity;s+=B.preferentialPrice}for(var v=0;v<o.productList.length;v++){var w=o.productList[v];var m=w.quantity;l+=w.ecshopPrice*m;s+=(w.ecshopPrice-w.skuPrice)*m;if(w.extendList.length>0){for(var u=0;u<w.extendList.length;u++){var r=w.extendList[u];var q=r.skuPrice;l+=q*m}}if(w.accidentList.length>0){for(var t=0;t<w.accidentList.length;t++){var k=w.accidentList[t];var q=k.skuPrice;l+=q*m}}}A=l-s;$("#cart-price").html(A.toFixed(2))},onok:function(k){ec.product.gotoshoppingCart()},oncancel:function(k){k.close();$(".ol_box_mask").remove()},onclose:function(k){$(".ol_box_mask").remove()}});j.open()});ec.product.enableAddCartButtons(b)},errorFunction:function(h){var i=new ec.box($("#popup-tips").val(),{boxid:"product-popup-box",boxclass:"ol_box_4",showButton:false,onopen:function(j){$("#popup-tips-msg").html(h.msg)},oncancel:function(j){j.close();$(".ol_box_mask").remove()},onclose:function(j){$(".ol_box_mask").remove()}});i.open();ec.product.enableAddCartButtons(b)}})};ec.product.removeAtrribute=function(b,c,a){return $.grep(b,function(e,d){return e[c]!=a})};