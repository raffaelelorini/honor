ec.pkg("ec.account");ec.load("ec.messages");ec.pkg("ec.order");var isloggedin=false;String.prototype.escape=function(){var a={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&apos;","/":"&#47;","\\":"&#92;"};return this.replace(/\[&<>"']/g,function(b){return a[b]||b})};ec.account.htmlEscape=function(a){return a.replace(/&/g,"&amp;").replace(/'/g,"&apos;").replace(/\//g,"&#47;").replace(/\\/,"&#92;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")};ec.load("jquery.autocomplete",{loadType:"lazy",callback:function(){$("#search-kw").autocomplete({serviceUrl:domainMain+"/search_keywords",minChars:1,maxHeight:400,deferRequestBy:100})}});function validateNumber(b){b=(b)?b:window.event;var a=(b.which)?b.which:b.keyCode;if(a>31&&(a<48||a>57)){b.preventDefault()}return true}function validateAlphaNumeric(b){b=(b)?b:window.event;var a=(b.which)?b.which:b.keyCode;if(!/^[ A-Za-z0-9]+$/i.test(String.fromCharCode(a))){b.preventDefault()}return true}function gid(a){return document.getElementById(a)}ec.account.isLogin=function(){return ec.account.id&&ec.account.loginName};ec.account.getStatus=function(a){$.ajax({url:domainAccount+"/status.json?t="+new Date().getTime(),dataType:"jsonp",timeout:10000,jsonop:"callback",type:"get",success:function(c){if(c&&c.id>0){ec.account.id=c.id;ec.account.uid=c.uid;ec.account.name=c.name;ec.account.nickName=c.nickName;ec.account.loginName=c.loginName;ec.account.email=c.email;ec.account.mobile=c.mobile;ec.account.isQueue=c.isQueue;ec.account.custGrade=c.custGrade;ec.account.custPrivilege=c.custPrivilege;ec.account.custPoint=c.custPoint;ec.account.userState=c.userState;ec.account.isAuthCust=c.isAuthCust;var b=ec.util.cookie.get("ifl_v");if(b=="1"){$.ajax({url:"/account/load",type:"POST"})}}a()}})};ec.account.getAccountStatus=function(a,c,b){if(a){if(b){ec.load({url:domainMain+"/account/status?"+(new Date()).getTime(),type:"js",onload:c})}else{ec.load({url:domainMain+"/account/status?"+(new Date()).getTime(),type:"js",loadType:"lazy",onload:c})}}};ec.account.getLoginInfo=function(g,d){var a=ec.util.cookie.get("ac_li");var c=ec.util.cookie.get("uid");var b=ec.util.cookie.get("isValCas");try{if(c&&b&&"false"==b){ec.account.id=ec.util.cookie.get("uid");ec.account.uid=ec.util.cookie.get("uid");ec.account.name=ec.util.cookie.get("user");ec.account.nickName=ec.util.cookie.get("name");ec.account.loginName=ec.util.cookie.get("user");ec.account.isValCas="false";$.ajax({url:domainMain+"/account/load?uid="+c,async:false,type:"POST"});ec.account.getAccountStatus(c,g,d);ec.account.isValCas=ec.util.cookie.get("isValCas");g();return}if(a&&c){ec.account.id=ec.util.cookie.get("uid");ec.account.uid=ec.util.cookie.get("uid");ec.account.name=ec.util.cookie.get("user");ec.account.nickName=ec.util.cookie.get("name");ec.account.loginName=ec.util.cookie.get("ac_loNa");ec.account.email=ec.util.cookie.get("ac_lel");ec.account.mobile=ec.util.cookie.get("ac_lmi");ec.account.isQueue=ec.util.cookie.get("ac_liq");ec.account.custGrade=ec.util.cookie.get("ac_lgc");ec.account.custPrivilege=ec.util.cookie.get("ac_cp");ec.account.custPoint=ec.util.cookie.get("ac_ltp");ec.account.userState=ec.util.cookie.get("ac_lus");g();return}}catch(f){}ec.account.getAccountStatus(c,g,d)};ec.account.guestOrderInfo=function(){if(ec.util.cookie.get("uid")==null||ec.util.cookie.get("guestssession")==1){$(".mc-menu-area").hide();$(".button-operate-cancel-order").hide();$(".button-operate-edit").hide()}};ec.account.guestTrackOrderInfo=function(){if(ec.util.cookie.get("uid")==null||ec.util.cookie.get("guestssession")==1){$("a#my-order").attr("href","javascript:ec.order.guestOrderDetailView();")}};ec.account.guestSubmitAction=function(a){$.ajax({type:"post",url:domainMain+"/up/index/guestLogin.json",dataType:"jsonp",success:function(b){if(!(b.success)){return}redirectToConfirmCart(a)}})};ec.order.trackOrderToken=function(){jQuery.ajax({url:domainMain+"/portal/generateToken",type:"POST",data:{flagCode:jQuery("input#flag_code").val()},dataType:"jsonp",success:function(a){jQuery("input#trackorder_random_token").attr("value",a.randomFlag)},error:function(c,b,a){jQuery("input#trackorder_random_token").attr("value","")}})};ec.order.guestOrderDetailView=function(c){if(c==null){var a=ec.encipher.encrypt(jsonInput.user_id);var d=a.pubkey;var e=a.val;orderId=jsonInput.orderCode;var b=$('<form action="'+domainMain+'/guest/order" method="post">');b.append('<input name="custId" type="hidden" value="'+e+'" />');b.append('<input name="pubkey" type="hidden" value="'+d+'" />');b.append('<input name="orderId" type="hidden" value="'+orderId+'" />')}else{var b=$('<form action="'+domainMain+'/guest/order" method="post" target="_top">');b.append('<input name="custId" type="hidden" value="'+c.userId+'" />');b.append('<input name="pubkey" type="hidden" value="'+c.pubkey+'" />');b.append('<input name="orderId" type="hidden" value="'+c.order_id+'" />')}$("body").append(b);b.submit()};ec.order.guestOrderInvoiceView=function(c,a){var b=$('<form action="'+domainMain+'/guest/order/invoice" method="post">');b.append('<input name="custId" type="hidden" value="'+c+'" />');b.append('<input name="orderId" type="hidden" value="'+a+'" />');$("body").append(b);b.submit()};ec.order.trackordersubmit=function(){var e=$("#track-order");var d=e.find("input[name=email_id]").val();var g=e.find("input[name=order_id]").val();var a=e.find("input[name=trackorder_random_token]").val();var c=e.find("input[name=flag_code]").val();var b=e.find("input[name=trackorder]").val();var f={};f.email_id=d;f.order_id=g;f.trackorder_random_token=a;f.flag_code=c;f.trackorder=b;new ec.ajax().submit({type:e.attr("method"),url:e.attr("action"),data:f,successFunction:function(h){if(h.success==true){ec.order.guestOrderDetailView(h)}else{jQuery("#track-order-message").html(h.error_msg)}}})};function trackOrder(){var b=true;var a=true;$("#email-msg, #order-msg").removeClass("label-error");$("#track-order-message").html("");$("#email-msg, #order-msg").text("");$("#email-msg, #order-msg").hide();b=emailValidation();a=orderValidation();if(b!=false&&a!=false){ec.order.trackordersubmit()}}function emailValidation(){if($.trim($("#email_id").val())==""){$("#email-msg").addClass("label-error");$("#email-msg").text(ec.messages.msgObj["base-req"]);$("#email-msg").show();return false}if(!validateEmail($("#email_id").val())){$("#email-msg").addClass("label-error");$("#email-msg").text(ec.messages.msgObj["base-email-valid"]);$("#email-msg").show();return false}}function orderValidation(){if($.trim($("#order_id").val())==""){$("#order-msg").addClass("label-error");$("#order-msg").text(ec.messages.msgObj["base-req"]);$("#order-msg").show();return false}}function validateEmail(a){var b=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return b.test(a)}function redirectToConfirmCart(a){var b=$('<form action="'+domainMain+'/order/confirmcart" method="post"></form>');b.append('<input name="sbs" type="hidden" value="'+a.sbs+'" />');b.append('<input name="types" type="hidden" value="'+a.types+'" />');b.append('<input name="qtys" type="hidden" value="'+a.qtys+'" />');b.append('<input name="ess" type="hidden" value="'+a.ess+'" />');b.append('<input name="pgID" type="hidden" value="'+a.pgID+'" />');if(a.state){b.append('<input name="state" type="hidden" value="'+a.state+'" />')}if(a.orderTag){b.append('<input name="orderTag" type="hidden" value="'+a.orderTag+'" />')}if(a.groupRecordId){b.append('<input name="groupRecordId" type="hidden" value="'+a.groupRecordId+'" />')}$("body").append(b);b.submit()}(function(){var b=function(){setTimeout(function(){if(ec.account.isLogin()){isloggedin=true;$("#my-order-login").show();$("#trackorder-link-logged").show();$("#trackorder-link").hide();var e;var g=ec.account.nickName||ec.util.escapeHtml(ec.account.name)||ec.account.loginName;if(g.startsWith("00")){e=g.slice(4);g=e}if(g.length>=10){g=g.substring(0,10)+"..."}$("#customer_name").html(g);if($("#cart_unlogin_info")[0]){$("#cart_unlogin_info p").html('<a href="'+domainMain+"/member/home?t="+new Date().getTime()+'">'+g+"</a>")}$("#login_status,#cart_login_info").show();$("#up_user_center").show();$("#unlogin_status,#cust_login_info").hide();var f=ec.util.cookie.get("caibeiShowMsg"),c=ec.util.cookie.get("caibeiHeadShow"),d=ec.util.cookie.get("caibeiJifenUrl");if(f!=undefined&&f!=null&&f.length>0){$("#HeadShow").html(c);$("#ShowMsg").html(f);$("#caibeiMsg").show()}}else{isloggedin=false;$("#trackorder-link").show();$("#trackorder-link-logged").hide();$("#my-order-login").hide()}},200)};var a=function(h){var g="callback"+new Date().getTime(),d=domainMain+"/account/login?type=frame&url="+encodeURIComponent(domainMain+"/account/upCallback.html?"+g),c="up-iframe-"+(new Date()).getTime(),e='<iframe class="boxIframe" width="100%" height="100%" frameborder="0" name="'+c+'" src="about:blank" scrolling="no"></iframe><script>setTimeout(function(){window["'+c+'"].location.href="'+d+'";} ,100);<\/script>';var f=new ec.box(e,{boxid:"ec_login",title:" ",remember:false,width:500,height:470,showButton:false,onclose:function(i){try{delete window[g]}catch(j){window[g]=null}i.find("iframe").each(function(){this.contentWindow.close();jQuery(this).remove()})}}).open();window[g]=function(){if(typeof isUseAccount!="undefined"&&isUseAccount=="true"){ec.account.getStatus(b)}else{ec.account.getLoginInfo(b,false);ec.util.cookie.get("ifl_v")}h();f.close()}};ec.account.afterLogin=function(c){if(ec.account.isLogin()){c()}else{}};if(typeof isUseAccount!="undefined"&&isUseAccount=="true"){ec.account.getStatus(b)}else{ec.account.getLoginInfo(b,true)}ec.ready(function(){Date.prototype.withoutTime=function(){var c=new Date(this);c.setHours(0,0,0,0);return c};ec.base.getTotal();if(window.location.href.indexOf("order/createcart")>-1||window.location.href.indexOf("payment/callback")>-1||window.location.href.indexOf("payment/select")>-1){if(ec.util.cookie.get("guestssession")==1){$("#guestlogin_status").show();$("#unlogin_status").hide()}}})})();ec.account.showVipInfo=function(){if(ec.account.userState&&ec.account.userState=="1"){$("#vip-inActive").hide();$("#vip-Active i").removeClass().addClass("icon-vip-level-"+ec.account.custGrade);$("#vip-Active").attr("title","VMALL V"+ec.account.custGrade+"member");$("#vip-Active").show();var a=[];a.push('<em class="vip-state" id="vip-info">&nbsp;&nbsp;&nbsp;&nbsp;');a.push('<a href="'+domainMain+'/member/point" title="VMALL V'+ec.account.custGrade+'member" id="vip-Active" ><i class="icon-vip-level-'+ec.account.custGrade+'"></i></a>');a.push("</em>");$("#cart_unlogin_info p").append(a.join(""))}else{if(ec.account.isValCas&&"false"==ec.account.isValCas){$("#vip-inActive").hide();$("#vip-Active").hide()}else{$("#cart_unlogin_info p").append('&nbsp;&nbsp;<em class="vip-state"><a class="link-noAct" href="'+domainMain+'/member/account" id="vip-inActive" title='+ec.messages.msgObj["base-req"]+">"+ec.messages.msgObj["base-dctvt"]+"</a></em>");$("#vip-inActive").show();$("#vip-Active").hide()}}};ec.pkg("ec.minicart");ec.minicart.del=function(c,d,a){var b={sbs:d.toString(),types:a.toString()};ec.cart.del(b,function(){$(c).parents("li").remove();ec.cart.getTotal();gaObj=[];gaProductObj={};gaProductObj.id=b.sbs;gaProductObj.name=jQuery(c).siblings(".productDetailsSection").find(".productDetails_label").find("a").text();gaProductObj.quantity=jQuery(c).siblings(".productDetailsSection").find(".noOfItemsSelected").find("label").text();gaObj.push(gaProductObj);ec.ga.removeFromcart(gaObj,"Remove product from mini cart")})};ec.pkg("ec.product");ec.product.history={load:function(c,b,a){$.ajax({url:domainMain+"/product/browsed/query.json",data:{size:b?b:undefined,pid:a?a:undefined},dataType:"json",success:function(d){if(!d.success){return}c(d.list||[])}})},add:function(b){var a=new Image();a.src=domainMain+"/product/browsed/add?id="+b+"&_t="+(new Date()).getTime();a=null},clear:function(b){var a=new Image();a.src=domainMain+"/product/browsed/clear?_t="+(new Date()).getTime();a=null;if(b){b()}}};ec.product.inventory={_data:{},set:function(b,a){this._data[b]=a},haveInventory:function(a){return this._data[a]}};ec.pkg("ec.cart");ec.cart.add=function(b,a,c){getRandomToken(function(){var e={};e.csrf_token=typeof csrftoken!=="undefined"?csrftoken:"";e.sbs=b.skuIds.join(",");e.type=b.type.join(",");e.qty=b.quantity.join(",");if(b.extendSkuIds&&b.extendSkuIds.length>0){e.ess=b.extendSkuIds.join(",")}if(e.qty==0||e.qty==""){var d={};d.msg=ec.messages.msgObj["product-invalid-quantity"];d.success=false;a.errorFunction(d);return false}$.ajax({url:domainMain+"/order/shoppingCart/addcart.json",dataType:"jsonp",timeout:30000,traditional:true,data:e,success:function(g){if(!g.success){if(a.errorFunction){a.errorFunction(g)}return}if(a.successFunction){e.qty=b.quantity.join(",");var f=new Date();e.t=f.getTime();$.ajax({url:domainCart+"/cart/add.json",dataType:"jsonp",timeout:30000,traditional:true,data:e,success:function(h){if(!h.success){if(a.errorFunction){a.errorFunction(h)}return}if(a.successFunction){a.successFunction(h)}},error:function(k,j,i){if(a.errorFunction){var h={};h.msg=j;a.errorFunction(h)}}})}},error:function(i,h,g){if(a.errorFunction){var f={};f.msg=h;a.errorFunction(f)}}})})};function processCustinPortal(a){if(a=="add"){var b=new Date();$.ajax({url:domainMain+"/cart/add.json?t="+new Date().getTime(),dataType:"jsonp",timeout:30000,traditional:true,async:false,success:function(c){console.log(c)},error:function(f,d,c){console.log(d)}})}if(a=="show"){$.ajax({url:domainMain+"/cart/shoppingCart.json?t="+new Date().getTime(),dataType:"jsonp",timeout:10000,async:false,success:function(c){console.log(c)},error:function(f,d,c){console.log(d)}})}if(a=="del"){$.ajax({url:domainMain+"/cart/del.json?t="+new Date().getTime(),dataType:"jsonp",timeout:10000,async:false,success:function(c){console.log(c)},error:function(f,d,c){console.log(d)}})}}ec.cart.getCartItemsInternal=function(b,a){$.ajax({url:domainCart+"/cart/shoppingCart.json?t="+new Date().getTime(),dataType:"jsonp",timeout:10000,success:function(c){if(c.cart&&c.cart.length>0){b(c.cart,a)}else{b(null,a)}}})};ec.cart.getCartItems=function(d,a){var c=ec.util.cookie.get("cartId");if(c&&c.length>0){var b=ec.util.cookie.get("isValCas");if(b&&"false"==b){$.ajax({url:"/account/load",type:"POST"});b=ec.util.cookie.get("isValCas")}if(ec.account.isLogin()){$.ajax({url:domainCart+"/cart/cache2cart.json?t="+new Date().getTime(),dataType:"jsonp",timeout:10000,cache:false,success:function(e){ec.cart.getCartItemsInternal(d,a)}})}else{ec.cart.getCartItemsInternal(d,a)}}else{ec.cart.getCartItemsInternal(d,a)}};ec.cart.buildQueryData=function(e){var h=[];var g=[];var b=[];var c=[];for(var f=0;f<e.length;f++){var a=e[f];if(a.skuId){h.push(a.skuId)}else{if(a.bundleId){h.push(a.bundleId)}else{continue}}g.push(a.productType);b.push(a.quantity);if(a.mainSkuId){c.push(a.mainSkuId)}else{c.push("")}}var d=new Date();return{sbs:h.join(","),types:g.join(","),qtys:b.join(","),ess:c.join(","),t:d.getTime()}};ec.cart.getOnceCartInfo=function(a,d,b){var c=ec.cart.buildQueryData(a);$.ajax({url:domainMain+"/order/shoppingCart/cart.json",dataType:"jsonp",timeout:10000,traditional:true,data:c,success:function(e){if(b!=null){d(e,b)}else{if(!e.success||!e.cartInfo){return}else{d(e)}}$(".icon-plus-3 ,.icon-minus-3").css({disabled:false,"pointer-events":"visible"})},error:function(){if(b!=null){var e={};e.success=false;d(e,b)}}})};ec.cart.batchCount=50;ec.cart.getCartInfo=function(e,o){if(!e||e.length==0){o({});return}if(e.length<=ec.cart.batchCount){ec.cart.getOnceCartInfo(e,o)}else{var n=[];var a=[];var d=[];outer:for(var h=0;h<e.length;h++){var b=e[h];if(b.productType==1){d.push(b);if(d.length==ec.cart.batchCount){n.push(d);d=[]}}else{if(b.productType==6){for(var f=0;f<n.length;f++){var g=n[f];if(g[0].productType==1){for(var c=0;c<g.length;c++){if(g[c].skuId==b.mainSkuId){g.push(b);continue outer}}}}for(var f=0;f<d.length;f++){if(d[f].skuId==b.mainSkuId){d.push(b)}}}else{a.push(b);if(a.length==ec.cart.batchCount){n.push(a);a=[]}}}}if(a.length>0){if(a.length+d.length<=ec.cart.batchCount){a.push(d);n.push(a)}else{n.push(a);n.push(d)}}else{if(d.length>0){n.push(d)}}var m={};m.cartInfo={};m.cartInfo.bundlerList=[];m.cartInfo.productList=[];m.cartInfo.couponList=[];m.cartInfo.premiumsList=[];m.cartInfo.totalOriginalPrice=0;m.cartInfo.totalPrice=0;m.limitstock=[];m.understock=[];var l=0;for(var h=0;h<n.length;h++){var g=n[h];ec.cart.getOnceCartInfo(g,function(j,k){l+=1;if(j.success&&j.cartInfo){if(j.cartInfo.bundlerList&&j.cartInfo.bundlerList.length>0){m.cartInfo.bundlerList=m.cartInfo.bundlerList.concat(j.cartInfo.bundlerList)}if(j.cartInfo.productList&&j.cartInfo.productList.length>0){m.cartInfo.productList=m.cartInfo.productList.concat(j.cartInfo.productList)}if(j.cartInfo.couponList&&j.cartInfo.couponList.length>0){m.cartInfo.couponList=m.cartInfo.couponList.concat(j.cartInfo.couponList)}if(j.cartInfo.premiumsList&&j.cartInfo.premiumsList.length>0){m.cartInfo.premiumsList=m.cartInfo.premiumsList.concat(j.cartInfo.premiumsList)}m.cartInfo.totalOriginalPrice+=j.cartInfo.totalOriginalPrice;m.cartInfo.totalPrice+=j.cartInfo.totalPrice;if(j.limitstock&&j.limitstock.length>0){m.limitstock=m.limitstock.concat(j.limitstock)}if(j.understock&&j.understock.length>0){m.understock=m.understock.concat(j.understock)}}if(l==n.length){o(m)}},h)}}};ec.cart.getCart=function(a){ec.cart.getCartItems(ec.cart.getCartInfo,a)};ec.cart.getCartBaseInfo=function(a,c){if(a&&a.length>0){var b=ec.cart.buildQueryData(a);$.ajax({url:domainMain+"/page/baseInfo.json",type:"POST",dataType:"json",data:b,success:function(d){c(d)}})}else{c({cartInfo:{totalNumber:0,totalPrice:0}})}};ec.cart.getCartBase=function(a){ec.cart.getCartItems(ec.cart.getCartBaseInfo,a)};ec.cart.getTotal=function(){ec.cart.getCartBase(function(s){var r=s.cartInfo,a=s.shopInfo,t=$("#empty-cart-container"),m=$("#cart-details-container"),o=$("#minicart-pro-settleup"),e=$("#header-cart-total");if(ec.minicart.microCartTpl){if(r.totalNumber>0){$("#header-cart-total,#micro-cart-total,#myCartLabelnoOfItems").html(r.totalNumber||0)}if(r.totalNumber>99){$("#header-cart-total,#micro-cart-total,#myCartLabelnoOfItems").html("99+");$("#myCartLabelnoOfItems").html(r.totalNumber||0)}if(r.totalNumber>0){e.show();var k=0;var c=0;var p=0;for(var q=0;q<r.bundlerList.length;q++){var l=r.bundlerList[q];k+=l.originalPrice*l.quantity;p+=l.preferentialPrice}for(var i=0;i<r.productList.length;i++){var b=r.productList[i];var f=b.quantity;k+=b.ecshopPrice*f;p+=(b.ecshopPrice-b.skuPrice)*f;if(b.extendList.length>0){for(var h=0;h<b.extendList.length;h++){var u=b.extendList[h];var n=u.skuPrice;k+=n*f}}if(b.accidentList.length>0){for(var g=0;g<b.accidentList.length;g++){var d=b.accidentList[g];var n=d.skuPrice;k+=n*f}}}c=k-p;$("#micro-cart-totalPrice").html(currencySymbol+""+parseFloat(c).toFixed(2));$("#productListInMyCart").html(ec.minicart.microCartTpl.parse("microCartList",r));m.show();o.show();t.hide();if((r.productList.length+r.bundlerList.length)>5){m.addClass("minicart-pro-list-scroll")}else{m.removeClass("minicart-pro-list-scroll")}}else{t.show();m.hide();o.hide();e.hide()}if(a){$("#toolbar-orderWaitingHandleCount").html(a.orderWaitingHandleCount).attr("class",(a.orderWaitingHandleCount<=0)?"hide":"");$("#toolbar-couponCount").html(a.couponCount).attr("class",(a.couponCount<=0)?"hide":"");$("#toolbar-newMsgCount").html(a.newMsgCount).attr("class",(a.newMsgCount<=0)?"hide":"")}}if(s.enterpriseUser){$("#preferential").html('<a  href="'+domainMain+'/member/enterprise" title="Offers within the purchase" rel="nofollow">Offers within the purchase</a>').show();$("#li-enterprise").html('<a href="'+domainMain+'/member/enterprise" title="Offers within the purchase"><span>Offers within the purchase</span></a>').show()}})};ec.cart.del=function(d,h,b){var g=d.types.split(",");var j=[];var e=[];var a=d.sbs.split(",");var f=a.length;for(var c=0;c<f;c++){if(g[c]==1){j.push(a[c])}else{if(g[c]==2){e.push(a[c])}}}if(!b){ec.ui.loading.show({modal:false})}getRandomToken(function(){var i=new Date();d.t=i.getTime();d.csrf_token=typeof csrftoken!=="undefined"?csrftoken:"";var k={data:d,dataType:"jsonp",timeout:10000,timeoutFunction:function(){ec.ui.loading.hide();alert(ec.messages.msgObj["base-op-tout"])},successFunction:function(l){if(!l.success){ec.ui.loading.hide();ec.showError(l);return}if(h){h(l)}ec.ui.loading.hide();return}};k.url=domainCart+"/cart/del.json";new ec.ajax().get(k)})};ec.cart.setRecover=function(a){ec.util.cookie.set("cart-recover",a,{domain:cookiedomain,path:"/"})};ec.cart.removeSkuFromRecover=function(b,d){var a=ec.util.cookie.get("cart-recover");if(a){var c=new RegExp(","+b+";\\d+,");a=a.replace(c,",");ec.cart.setRecover(a)}if(d){d(a)}};ec.cart.guestconfirm=function(){_paq.push(["trackLink","Shopping Cart - go to the settlement","link"," "]);var a=$("#cart-list input[name='skuIds']:checked");var b=$("#cart-list input[name='bundleIds']:checked");if(a.length==0&&b.length==0){alert(ec.messages.msgObj["base-min-prod"]);return}if(!ec.shoppingCart._checkUnderstockAndLimitstock()){return false}ec.cart.jumpToConfirm(a,b)};ec.cart.jumpToConfirm=function(a,f){var d=[];var b=[];var c=[];var e=[];a.each(function(){var g=$(this).closest("tbody");var l=this.value;var k=$("#quantity-"+l,g).val();var i=$("#quantity-"+l,g).attr("data-type");if(k){d.push(l);b.push(i);c.push(k);e.push("");var j=$('input[name="extendIds"]',g).val();if(j){d.push(j);b.push(6);c.push(k);e.push(l)}var h=$('input[name="accidentIds"]',g).val();if(h){d.push(h);b.push(7);c.push(k);e.push(l)}}});f.each(function(){var g=$(this).closest("tbody");var j=this.value;var i=$("#quantity-bundle-"+j,g).val();var h=$("#quantity-bundle-"+j,g).attr("data-type");if(i){d.push(j);b.push(h);c.push(i);e.push("")}});setTimeout(function(){ec.cart.confirm(1,d.join(","),b.join(","),c.join(","),e.join(","))},500)};ec.cart.confirm=function(h,f,c,e,g,b,d){if(ec.util.cookie.get("uid")||isGuestEnabled==0){var a=$('<form action="'+domainMain+'/order/confirmcart" method="post"></form>')}else{var a=$('<form action="'+domainMain+'/up/index/checkout" method="post"></form>')}a.append('<input name="sbs" type="hidden" value="'+f+'" />');a.append('<input name="types" type="hidden" value="'+c+'" />');a.append('<input name="qtys" type="hidden" value="'+e+'" />');a.append('<input name="ess" type="hidden" value="'+g+'" />');a.append('<input name="pgID" type="hidden" value="checkout_new" />');if(h){a.append('<input name="state" type="hidden" value="'+h+'" />')}if(b){a.append('<input name="orderTag" type="hidden" value="'+b+'" />')}if(d){a.append('<input name="groupRecordId" type="hidden" value="'+d+'" />')}$("body").append(a);a.submit()};ec.pkg("ec.base");ec.base.getTotal=function(){$.ajax({url:domainMain+"/page/totalInfo.json",dataType:"jsonp",success:function(a){if(a.enterpriseUser){$("#preferential").html('<a href="'+domainMain+'/member/enterprise" title="优惠内购" rel="nofollow">优惠内购</a>').show();$("#li-enterprise").html('<a href="'+domainMain+'/member/enterprise" title="优惠内购"><span>优惠内购</span></a>').show()}}})};function search(c){var b=$("#search-kw").val();if(ec.util.isEmpty(b)){b=$("#default-search").val();if(ec.util.isEmpty(b)){return false}return false}window.location.href=domainMain+"/search?keyword="+encodeURIComponent(ec.account.htmlEscape(b));return false}(function(){var a;ec.ready(function(){$("#ec_ui_confirm_no").unbind("click").bind("click",function(){$("#ec_ui_confirm").hide();$.fancybox.close()});$("#ec_ui_confirm_new_no").unbind("click").bind("click",function(){$("#ec_ui_confirm_new").hide();$.fancybox.close()});$("#ec_ui_tips_yes").unbind("click").bind("click",function(){$("#ec_ui_tips").hide();$.fancybox.close()})});ec.ui.confirm=function(h,d){var c=ec.ui.confirm.caller,b=c.arguments;if(a!=null&&b[b.length-1]==a){a=null;return true}$("#ec_ui_confirm_msg").html(d);var m=$(h),f=$("#ec_ui_confirm"),j=m.offset(),o=j.top-f.outerHeight(true)-5,e=j.left-f.outerWidth(true)/2,n=[],g=b.length,l=b.callee.length;for(var k=0;k<g;k++){n.push(b[k])}n[l]=(a=(new Date()).getTime());$(".button-action-yes").unbind("click").bind("click",function(){$("#ec_ui_confirm").hide();$.fancybox.close();c.apply(this,n);n=null});$.fancybox.open("#ec_ui_confirm",{autoHeight:true,title:"",maxHeight:"50%",maxWidth:"50%",autoWidth:true,helpers:{title:{type:"inside",position:"top"}},beforeShow:function(){$("#livechat-compact-container").hide();$("#ec_ui_confirm_yes").focus()},afterClose:function(){$("#livechat-compact-container").show()}});return false};ec.ui.confirmNew=function(k,d,f,p){var c=ec.ui.confirmNew.caller,b=c.arguments;if(a!=null&&b[b.length-1]==a){a=null;return true}$("#ec_ui_confirm_new_msg").html(d);if(f){$("#ec_ui_confirm_new_yes").attr("title",f);$("#ec_ui_confirm_new_yes").html("<span>"+f+"</span>")}if(p){$("#ec_ui_confirm_new_no").attr("title",p);$("#ec_ui_confirm_new_no").html("<span>"+p+"</span>")}var n=$(k),g=$("#ec_ui_confirm_new"),j=n.offset(),q=j.top-g.outerHeight(true)-5,e=j.left-g.outerWidth(true)/9,o=[],h=b.length,m=b.callee.length;for(var l=0;l<h;l++){o.push(b[l])}o[m]=(a=(new Date()).getTime());$("#ec_ui_confirm_new_yes").unbind("click").click(function(){$("#ec_ui_confirm_new").hide();$.fancybox.close();c.apply(this,o);o=null});$.fancybox.open("#ec_ui_confirm_new",{autoHeight:true,title:"",maxHeight:"50%",maxWidth:"50%",autoWidth:true,helpers:{title:{type:"inside",position:"top"}},beforeShow:function(){$("#livechat-compact-container").hide();$("#ec_ui_confirm_new_yes").focus()},afterClose:function(){$("#livechat-compact-container").show()}});return false};ec.ui.tips=function(h,g){$("#ec_ui_tips_msg").html(g);var c=$(h),b=$("#ec_ui_tips"),f=c.offset(),e=f.top-b.outerHeight(true)-5,d=f.left-b.outerWidth(true)/2;$("#ec_ui_tips_yes").unbind("click").bind("click",function(){$("#ec_ui_tips").hide();$.fancybox.close()});$.fancybox.open("#ec_ui_tips",{autoHeight:true,title:"",maxHeight:"50%",maxWidth:"50%",autoWidth:true,helpers:{title:{type:"inside",position:"top"}},beforeShow:function(){$("#livechat-compact-container").hide();$("#ec_ui_tips_yes").focus()},afterClose:function(){$("#livechat-compact-container").show()}})}})();$.extend(ec.form.validator.defaults,{errorClass:"error",autoFocus:false,errorFunction:function(c,a){var b="icon-error",d=a.msg[a.type]||a.msg["default"];d=(d.length<=0)?"&nbsp;":d;switch(a.type){case"require":b="icon-warn";break}if(a.msg_ct){$(a.msg_ct).html("<span class='vam "+b+"'>"+d+"</span>")}else{var e=(c.attr("id")||c.attr("name"))+"-msg";$("#"+e).remove();c.after("<span id='"+e+"' class='vam "+b+"'>"+d+"</span>")}if(a.autoFocus){c.focus()}},successFunction:function(b,a){if(a.msg_ct){$(a.msg_ct).html("")}else{$("#"+(b.attr("id")||b.attr("name"))+"-msg").remove()}}});ec.form.validator.register("mobile",function(b,a){if(a.allowEmpty&&ec.util.isEmpty(b)){return true}if(b.length<9){return false}return/^[0-9]{10}$/.test(b)});ec.form.validator.register("phone",function(b,a){if(a.allowEmpty&&ec.util.isEmpty(b)){return true}if(b.length<7){return false}return/^((0[0-9]{2,3}\-)?[2-9][0-9]{6,7}|((00852|\+852)\-)?([2-3][0-9]{7}))+(\-[0-9]{1,4})?$/.test(b)});ec.form.validator.register("mobleOrPhone",function(b,a){if(a.allowEmpty&&ec.util.isEmpty(b)){return true}if(b.length<11){return false}return/(^((0[0-9]{2,3}\-)?[2-9][0-9]{6,7}|((00852|\+852)\-)?([2-3][0-9]{7}))+(\-[0-9]{1,4})?$)|(^(\+|00)?((86)?(1[34578])[0-9]{9}|852[965][0-9]{7})$)/.test(b)});ec.form.validator.register("forbidChar",function(b,a){if(a.allowEmpty&&ec.util.isEmpty(b)){return true}b=b.replace("*","@"),b=b.replace("--","@"),b=b.replace("https://store.hihonor.com/","@"),b=b.replace("+","@"),b=b.replace("'","@"),b=b.replace("\\","@"),b=b.replace("$","@"),b=b.replace("^","@"),b=b.replace(".","@"),b=b.replace(";","@"),b=b.replace("<","@"),b=b.replace(">","@"),b=b.replace('"',"@"),b=b.replace("=","@"),b=b.replace("{","@"),b=b.replace("}","@");b=b.replace("%","@");b=b.replace("~","@");b=b.replace("&","@");if(b.search(new RegExp("@"))!=-1){return false}return true});ec.form.validator.register("forbidCharAddress",function(e,b){var d=JSON.parse(addressFormatAddress).blockedChars;if(d!=undefined){var a=d.split(",");var f=a.length;for(var c=0;c<f;c++){e=e.replace(a[c],"@")}}if(b.allowEmpty&&ec.util.isEmpty(e)){return true}e=e.replace("`","@");e=e.replace("!","@");e=e.replace("@","@");e=e.replace("#","@");e=e.replace("&","@");e=e.replace(",","@");e=e.replace("(","@");e=e.replace(")","@");e=e.replace("?","@");e=e.replace(".","@");e=e.replace("_","@");e=e.replace(":","@");e=e.replace("*","@");e=e.replace("--","@");e=e.replace("+","@");e=e.replace("$","@");e=e.replace("^","@");e=e.replace(";","@");e=e.replace("<","@");e=e.replace(">","@");e=e.replace('"',"@");e=e.replace("=","@");e=e.replace("{","@");e=e.replace("}","@");e=e.replace("%","@");e=e.replace("~","@");if(e.search(new RegExp("@"))!=-1){return false}return true});ec.ui.number=function(a,b){var c={max:null,min:null,showButton:true,minusBtn:'<a title="减" class="icon-minus vam" href="javascript:;"><span>-</span></a>',plusBtn:'<a title="加" class="icon-plus vam" href="javascript:;"><span>+</span></a>'},d=$(a),b=$.extend(c,b),e=function(f){var h=f.which,g=parseInt(this.value,10),i=(g<1)?1:g;if((h<37||h>40)&&h!=8&&h!=46){if(i>b.max||i<b.min){f.preventDefault();return false}else{if((f.shiftKey||h<48||h>57)&&(h<96||h>105)&&h!=9){f.preventDefault();return false}}}};d.each(function(){var h=$.extend({},b),f=$(this).css("ime-mode","disabled");var g=f.attr("max");if(g){b.max=h.max=parseInt(g,10)||h.max}g=f.attr("min");if(g){b.min=h.min=parseInt(g,10)||h.min}if(h.showButton){var j=$(h.minusBtn).click(function(){var k=f.val()||0,l=parseInt(k,10)-1;if(typeof(h.min)=="number"&&l<h.min){return}f.val(l).trigger("blur")}),i=$(h.plusBtn).click(function(){var k=f.val()||0,l=parseInt(k,10)+1;if(typeof(h.max)=="number"&&l>h.max){return}f.val(l).trigger("blur")});f.after(i).before(j)}f.data("ovalue",f.val()||0).keydown(e).keyup(function(){var k=parseInt(this.value||0);if(typeof(h.min)=="number"&&k<h.min){this.value=h.min;return}else{if(typeof(h.max)=="number"&&k>h.max){this.value=h.max;return}}}).blur(function(){if(typeof h.onchange==="function"){var k=f.data("ovalue"),l=this.value||0,m=parseInt(l,10)-parseInt(k,10);if(m==0){return}f.data("ovalue",l);h.onchange.call(this,l,m)}})})};ec.ui.countdown=function(d,l){var f=$(d),b=f.data("countdown"),k=0,i,j,e=l.now.getTime()-new Date().getTime(),c=0,h=function(){if(k>=l.times.length){return false}i=l.times[k];k++;return true},g=function(){c=Math.round((i.parseDate("yyyy-MM-dd HH:mm:ss").getTime()-new Date().getTime()-e)/1000);c=c<=0?0:c;return c},a=function(){c--;if(c<=0){c=0}j={day:Math.floor(c/(24*60*60)),hour:(l.html.indexOf("{#day}")>=0)?Math.floor(c/60/60)%24:Math.floor(c/60/60),minute:Math.floor(c/60)%60,second:c%60};var m=l.html.replace(/{#day}/g,j.day).replace(/{#hours}/g,j.hour>9?j.hour:"0"+j.hour).replace(/{#minutes}/g,j.minute>9?j.minute:"0"+j.minute).replace(/{#seconds}/g,j.second>9?j.second:"0"+j.second);f.html(m);return(c<=0)?false:true};if(!l.times){l.times=[l.endTime]}clearInterval(b);while(h()){if(g()<=0){continue}break}if(!a()){return}b=setInterval(function(){if(!a()){if(l.callback){l.callback(l)}if(!h()){clearInterval(b)}else{g()}}},1000);f.data("countdown",b)};(function(){var b=$(window),i=false,a=document.compatMode=="CSS1Compat"?document.documentElement:document.body,f=0,c=0,g,d=[],e,h=function(j){var k=j.offset().top,l=k+j.height();if((k>=f&&k<=c)||(l>=f&&l<=c)){j.attr("src",j.attr("data-lazy-src"));j.removeAttr("data-lazy-src");return true}return false};_bindEvent=function(){var j=function(){clearTimeout(e);e=setTimeout(function(){f=b.scrollTop();c=f+g;var l;for(var m=0;m<d.length;m++){l=d[m];if(h(l)){d.splice(m,1);m--}}if(!d||d.length==0){b.unbind("scroll",j);b.unbind("resize",k)}},100)},k=function(l){g=a.clientHeight};b.bind("scroll",j);b.bind("resize",k);g=a.clientHeight;f=b.scrollTop();c=f+g};ec.ui.lazyLoad=function(j){if(!i){_bindEvent();i=true}$(j).each(function(){if(this.tagName!="IMG"){return}var k=$(this);if(k.attr("data-lazy-src")){if(!h(k)){k.attr("src",domainMain+"/images/echannel/loading/mask.png");d.push(k)}}})}})();ec.ready(function(){ec.ui.lazyLoad($("body").children(".layout,.g,.home-channel-container").find("img"));ec.ui.hrefSetTime();var a=!!window.MSInputMethodContext&&!!document.documentMode;if(a){if($("input[type=checkbox]").length>0){$("input[type=checkbox]").wrap("<div class='IECheckboxBorder'>");$(".IECheckboxBorder").css("display","inline-block");$("input[type=checkbox]").addClass("IECheck")}if($("input[type=radio]").length>0){$("input[type=radio]").wrap("<div class='IEBorder'>")}}});ec.showError=function(a){if(typeof a.code!=="undefined"&&a.code!=""){if(a.code=="login"){alert(ec.messages.msgObj["base-login-tout"]);location.reload();return false}else{alert(ec.messages.msgObj[a.code]);return}}alert(a.msg)};ec.load("ajax",{loadType:"lazy"});(function(){var a=function(){var e=ec.form.validator.bind,d=$("#surveryContent"),b=$("#surveryContact"),c=$("#surveryVerify");e(d,{type:["require","length","forbidChar"],validOnChange:true,msg_ct:"#errMsg",max:200,min:5,msg:{require:ec.messages.msgObj["base-no-fbbk"],length:ec.messages.msgObj["base-fbbk-info"],forbidChar:ec.messages.msgObj["base-fbbk-illegal"]}});e(b,{type:["length"],validOnChange:true,msg_ct:"#errMsg",min:2,max:100,msg:{length:ec.messages.msgObj["base-cor-cntct"]}});e(c,{type:["require"],validOnChange:true,msg_ct:"#errMsg",msg:{require:ec.messages.msgObj["base-vcode"]}});if(ec.account.isLogin()){b.val(ec.util.escapeHtml(ec.account.email)||ec.util.escapeHtml(ec.account.mobile)||ec.account.loginName)}ec.form.input.label(b,ec.messages.msgObj["base-mbox"]);ec.form.input.label(d,ec.messages.msgObj["base-thx-imp"])};ec.survery={open:function(){if(a){a();a=null}ol.ui.masker.mask({css:{opacity:0.4}});ec.survery.reloadCode();$("#survery-box").show()},close:function(){ol.ui.masker.unmask();$("#survery-box").hide()},submit:function(c){if(!ec.form.validator(c,true)){return false}var b=this.box;new ec.ajax().submit({form:c,url:domainMain+"/feedback.json",timeout:10000,timeoutFunction:function(){alert(ec.messages.msgObj["base-sv-tout"])},successFunction:function(d){if(!d.success){$("#errMsg").html('<span class="error">'+ec.messages.msgObj["base-sv-tout"]+d.msg+"</span>");return}alert(ec.messages.msgObj["base-sv-tout"]);ec.survery.close();$("#surveryContent,#surveryVerify").val("");return}});return false},reloadCode:function(){gid("surveryVerifyImg").src="/feedback/randomCode?_t="+(new Date()).getTime()}}})();$(function(){var c=$(window),d,b=$("#hungBar-top"),a=function(){b.stop();$(document).ready(function(){b.fadeOut(0);if(c.scrollTop()>1200){b.show()}else{b.hide()}});d=null};c.scroll(function(){d=setTimeout(a,50)});a()});(function(){ec.ui.hrefSetTime=function(){var b=(new Date()).getTime();try{$("a[timeType=timestamp]").each(function(){var c=$(this);c.attr("href",c.attr("href").replace(/timestamp/g,b))})}catch(a){console.log(a)}}})();ec.pkg("ec.encipher");ec.load("ec.aes");ec.load("ec.dh");ec.encipher.base=10;ec.encipher.bigPowMod=function(f,e,g){f=str2bigInt(f,ec.encipher.base);e=str2bigInt(e,ec.encipher.base);g=str2bigInt(g,ec.encipher.base);var d=powMod(f,e,g);d=bigInt2str(d,ec.encipher.base);return d};ec.encipher.randomInt=function(b){var a=randBigInt(b,0);return bigInt2str(a,ec.encipher.base)};ec.encipher.getServerKey=function(){$.ajax({type:"get",url:domainMain+"/system/getKey.json?t="+new Date().getTime(),async:false,dataType:"json",timeout:10000,success:function(a){if(!(a.success)){return}ec.util.cookie.set("sc_p",a.pubkey,{domain:cookiedomain,path:"/"})}})};ec.encipher.getEncryptData=function(a,d,j){var l="";var g="13232376895198612407547930718267435757728527029623408872245156039757713029036368719146452186041204237350521785240337048752071462798273003935646236777459223",k="5421644057436475141609648488325705128047428394380474376834667300766108262613900542681289080713724597310673074119355136085795982097390670890367185141189796",i=ec.encipher.randomInt(128),c=ec.encipher.bigPowMod(k,i,g),e=ec.util.cookie.get("sc_p"),h,f;if(d==""||d==null){f=a+"?pubkey="+c+"&seType=a&t="+new Date().getTime()}else{f=a+"?argument="+d+"&pubkey="+c+"&seType=a&t="+new Date().getTime()}$.ajax({type:"get",url:f,dataType:"json",async:false,timeout:10000,success:function(b){if(!b.success){return}h=ec.encipher.bigPowMod(e,i,g);l=j(b.data,h)}});return l};ec.encipher.getKey=function(g){var d="13232376895198612407547930718267435757728527029623408872245156039757713029036368719146452186041204237350521785240337048752071462798273003935646236777459223",e="5421644057436475141609648488325705128047428394380474376834667300766108262613900542681289080713724597310673074119355136085795982097390670890367185141189796",a=ec.encipher.randomInt(128),f=ec.encipher.bigPowMod(e,a,d),c;$.ajax({type:"get",url:domainShoppingConfig+"/member/smyAddresses.json",dataType:"jsonp",data:{pubkey:f,seType:"a",countryId:countrycode,t:new Date().getTime()},async:true,timeout:10000,success:function(b){if(!b.success){return}ec.util.cookie.set("sc_p",b.pubkey,{domain:cookiedomain,path:"/"});c=ec.encipher.bigPowMod(b.pubkey,a,d);g(b.shoppingConfigList,b.randomFlag,c)}})};ec.encipher.encrypt=function(h){var d="13232376895198612407547930718267435757728527029623408872245156039757713029036368719146452186041204237350521785240337048752071462798273003935646236777459223",g="5421644057436475141609648488325705128047428394380474376834667300766108262613900542681289080713724597310673074119355136085795982097390670890367185141189796",a=ec.encipher.randomInt(128),i=ec.encipher.bigPowMod(g,a,d),e=ec.util.cookie.get("sc_p"),c=ec.encipher.bigPowMod(e,a,d);iterationCount=1000;keySize=128,iv="d5fbec7fcfead800e9531d68a76b0981".toString(CryptoJS.enc.Hex),salt="5d99868014a72fdc3e60ad1b48224b12".toString(CryptoJS.enc.Hex),aesUtil=new AesUtil(keySize,iterationCount);var f=aesUtil.encrypt(salt,iv,c,h);return{val:f,pubkey:i}};ec.encipher.decrypt=function(h,b){var a=1000,f=128,c="d5fbec7fcfead800e9531d68a76b0981".toString(CryptoJS.enc.Hex),d="5d99868014a72fdc3e60ad1b48224b12".toString(CryptoJS.enc.Hex),e=new AesUtil(f,a);var g=e.decrypt(d,c,b,h);return g};ec.pkg("ec.order");ec.pkg("ec.addr");ec.addr.validate=function(b,d,c){var e="provinceCode="+b;e=e+"&cityName="+d;e=e+"&postCode="+c;var a=0;if(countrycode!="1"){a=1;return a}$.ajax({url:domainMain+"/ups/zipValidation.json?"+e,type:"get",dataType:"json",async:false,beforeSend:function(){ec.ui.loading.show({modal:false})},complete:ec.ui.loading.hide,success:function(f){if(f.status=="true"){a=1}else{$("#zipCode-msg").addClass("label-error");$("#zipCode-msg").text(ec.messages.msgObj["add-zip-valid"]);$("#zipCode-msg").show();return a}},error:function(f){console.log("error in zipValidation",f)}});return a};ec.addr.save=function(d,g,c){var r=$(d);var j=r.find("select[name='province'] option:selected").html();var m=r.find("select[name='city'] option:selected").html();var b=r.find("select[name=province]").val();var q=r.find("input[name=zipCode]").val();var y=r.find("input[name=id]").val();var k="/member/smyAddresses.json?_method=post";var v="post";var i=r.find("input[name=address]").val();var A=r.find("select[name=city]").val();var h=r.find("input[name=flow]").val();if(""==b&&A==undefined){$("#myAddress-msg").addClass("label-error");$("#myAddress-msg").text(ec.messages.msgObj["add-state"]);$("#myAddress-msg").show();if($("#myAddress-edit").length>0){$("#province").attr("style","border-color: #f9dcce")}else{$("#province").attr("style","border-color: #e01d21!important")}}else{$("#province").attr("style","border-color: none")}if(""!=b&&A==""&&A!=undefined){$("#myAddress-msg").addClass("label-error");$("#myAddress-msg").text(ec.messages.msgObj["add-city"]);$("#myAddress-msg").show();if($("#myAddress-edit").length>0){$("#city").attr("style","border-color: #f9dcce")}else{$("#city").attr("style","border-color: #e01d21!important")}}else{$("#city").attr("style","border-color: none")}if(ec.util.isEmpty(i)){r.find("#address-msg").addClass("label-error");r.find("#address-msg").text(ec.messages.msgObj["base-add-line-One"])}var o=r.find("input[name=mobile]");var f=$.trim(r.find("input[name=mobile]").val());if(ec.util.isEmpty(f)){r.find("#mobile-msg").addClass("label-error");r.find("#mobile-msg").text(ec.messages.msgObj["confirm-no-mob"])}var t=r.find("input[name=email]").val();if(t!=undefined){if(ec.util.isEmpty(t)){r.find("#email-msg").addClass("label-error");r.find("#email-msg").text(ec.messages.msgObj["add-email"])}}else{t=null}if(!ec.form.validator(r,false)||""==b&&A==undefined||""!=b&&A==""&&A!=undefined){return false}if(g.afterCheck){g.afterCheck(y)}if(g.type!="add"){k="/member/smyAddresses/"+y+".json?_method=put"}var l=r.find("input[name=consignee]").val();var B=r.find("input[name=firstname]").val();var n=r.find("input[name=lastname]").val();var p=r.find("input[name=address]").val();var e=r.find("input[name=building]").val();var x=c;var E={};if(l!=undefined){E.consignee=l}else{E.consignee=B+" "+n}E.firstName=B;E.lastName=n;if(B==undefined&&l!=undefined){var z=l.match(/\S+/g)||[];E.firstName=z[0]}E.province=b;E.city=A;E.building=e;E.address=p;E.zipCode=q;E.mobile=f;E.provinceName=j;E.cityName=m;E.phone=null;E.randomFlag=x;E.defaultShipping=0;E.defaultBilling=0;E.email=t;E.countryId=countrycode;var w=r.find("input[name=defaultShipping]");var s=r.find("input[name=defaultBilling]");if(w.length==1&&w[0].checked&&!w[0].disabled){E.defaultShipping=w.val()}if(s.length==1&&s[0].checked&&!s[0].disabled){E.defaultBilling=s.val()}if(!(w).is(":visible")){E.defaultShipping=null}if(!(s).is(":visible")){E.defaultBilling=null}E.t=new Date().getTime();var C=ec.lang.json.stringify(E);C=ec.encipher.encrypt(C);var a=C.pubkey;C=encodeURIComponent(C.val);var u="";var D=ec.addr.validate(j,m,q);if(D==1){new ec.ajax().get({url:domainShoppingConfig+k+"&pubkey="+a+"&encryptedData="+C+"&seType=a&t="+new Date().getTime(),dataType:"jsonp",timeout:20000,timeoutFunction:function(){alert("Save timeout, please try again!")},beforeSendFunction:ec.ui.loading.show,afterSendFunction:ec.ui.loading.hide,successFunction:function(G){if(!G.success){ec.showError(G);return}if(g.successFunction){if(ec.order.customertype!=3){g.successFunction(G.shoppingConfigList,d)}else{ec.encipher.getServerKey();E.t=new Date().getTime();var F=ec.lang.json.stringify(E);F=ec.encipher.encrypt(F);var H=F.pubkey;F=encodeURIComponent(F.val);new ec.ajax().submit({url:domainMain+"/customer/guestUserAddresses.json?_method=put&pubkey="+H+"&encryptedData="+F+"&flow="+h+"&seType=a&t="+new Date().getTime(),timeout:200000,timeoutFunction:function(){alert("Save timeout, please try again!")},beforeSend:function(){ec.ui.loading.show({modal:false})},complete:ec.ui.loading.hide,successFunction:function(I){if(!I.success){ec.showError(I);return}g.successFunction(I.shippingJsonObj,I.billingJsonObj,I.randomFlag,I.pubkey)}})}}}})}return false};ec.addr.setDefault=function(e,b){var d=ec.util.cookie.get("sc_b");var a;var c;if(typeof(ec.util.cookie.get("shippingFlag"))!=undefined||typeof(ec.util.cookie.get("billingFlag")!=undefined)){a=ec.util.cookie.get("shippingFlag");c=ec.util.cookie.get("billingFlag")}else{a=0;c=0}new ec.ajax().get({url:domainShoppingConfig+"/member/myAddresses/default.json",dataType:"jsonp",data:{id:e,countryId:countrycode,defaultShipping:a,defaultBilling:c,_method:"PUT",t:new Date().getTime()},timeout:20000,timeoutFunction:function(){alert(ec.messages.msgObj["base-op-tout"])},beforeSendFunction:function(){ec.ui.loading.show({modal:false})},afterSendFunction:ec.ui.loading.hide,successFunction:function(f){if(!f.success){ec.showError(f);return}if(b.successFunction){b.successFunction(e)}}})};ec.addr.getAll=function(a){new ec.ajax().get({url:domainShoppingConfig+"/member/myAddresses.json",dataType:"jsonp",data:{countryId:countrycode},timeout:20000,timeoutFunction:function(){alert(ec.messages.msgObj["base-op-tout"])},beforeSendFunction:function(){ec.ui.loading.show({modal:false})},afterSendFunction:ec.ui.loading.hide,successFunction:function(b){if(!b.success){ec.showError(b);return}if(a.successFunction){a.successFunction(b)}}})};ec.addr.del=function(c,a,b){new ec.ajax().get({url:domainShoppingConfig+"/member/myAddresses/"+c+".json",dataType:"jsonp",data:{_method:"delete",countryId:countrycode,randomFlag:b},timeout:10000,timeoutFunction:function(){alert(ec.messages.msgObj["base-rd-tout"])},beforeSendFunction:ec.ui.loading.show,afterSendFunction:ec.ui.loading.hide,successFunction:function(d){if(!d.success){ec.showError(d);if(d.code=="default"){if(a.deleteDefault){a.deleteDefault(c)}}return}if(a.successFunction){a.successFunction(c)}}})};function base64_encode(e){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789%2b/index.html";var c,b="",d=e.length;for(c=0;c<d-2;c+=3){b+=a.charAt(e.charCodeAt(c)>>>2);b+=a.charAt(((e.charCodeAt(c)&3)<<4)|(e.charCodeAt(c+1)>>>4));b+=a.charAt(((e.charCodeAt(c+1)&15)<<2)|(e.charCodeAt(c+2)>>>6));b+=a.charAt(e.charCodeAt(c+2)&63)}if(d%3===2){b+=a.charAt(e.charCodeAt(c)>>>2);b+=a.charAt(((e.charCodeAt(c)&3)<<4)|(e.charCodeAt(c+1)>>>4));b+=a.charAt(((e.charCodeAt(c+1)&15)<<2));b+="="}else{if(d%3===1){b+=a.charAt(e.charCodeAt(c)>>>2);b+=a.charAt(((e.charCodeAt(c)&3)<<4));b+="=="}}return b}function base64_decode(h){var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var c,b,a,m,l,k,j,n,g=0,o=0,e="",f=[];if(!h){return h}h+="";do{m=d.indexOf(h.charAt(g++));l=d.indexOf(h.charAt(g++));k=d.indexOf(h.charAt(g++));j=d.indexOf(h.charAt(g++));n=m<<18|l<<12|k<<6|j;c=n>>16&255;b=n>>8&255;a=n&255;if(k==64){f[o++]=String.fromCharCode(c)}else{if(j==64){f[o++]=String.fromCharCode(c,b)}else{f[o++]=String.fromCharCode(c,b,a)}}}while(g<h.length);e=f.join("");return e.replace(/\0+$/,"")}ec.pkg("ec.prescription");ec.prescription.getEstimateGetOrderTime=function(d,b,c,a){$.ajax({url:domainMain+"/order/estimateTime.json?d="+b+"&p="+c+"&i="+a,dataType:"jsonp",timeout:20000,jsonpCallback:"jsonpEstimate",timeout:function(){d(null,true)},beforeSend:function(){ec.ui.loading.show({modal:false})},complete:ec.ui.loading.hide,success:function(e){d(e.info,false)},error:function(){d(null,true)}})};function validateZip(a){if(countrycode=="44"){return validateAlphaNumeric(a)}return validateNumber(a)}function getRandomToken(a){a();return;$.ajax({url:domainCart+"/cart/csrftoken.js",dataType:"jsonp",timeout:20000,async:false,timeout:function(){alert(ec.messages.msgObj["base-op-tout"])},success:function(b){getToken();a()},error:function(){getToken();a()}})};